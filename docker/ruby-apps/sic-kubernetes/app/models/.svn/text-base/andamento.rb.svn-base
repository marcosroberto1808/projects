class Andamento < ActiveRecord::Base
  belongs_to :classificacao_andamento
  belongs_to :documento

  validates_presence_of :classificacao_andamento_id, :data

  after_destroy :remove_filhos

  def processo_judicial
  	ProcessoJudicial.find(processo_id)
  end

  def remove_filhos
  	#remove notificações
    @assistido = self.processo_judicial.assistido_id
    @notificacoes = Notificacao.where(assistido_id: @assistido, descricao: "Notificação de 30 dias do relaxamento de prisão.", andamento_id: self.id)
    if @notificacoes.present?
    	@notificacoes.destroy_all
    end
    #remove documento
    if self.documento_id.present?
      @documento = Documento.find(self.documento_id)
      @documento.destroy
    end
  end
end