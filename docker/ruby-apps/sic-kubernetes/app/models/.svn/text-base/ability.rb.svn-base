class Ability
  include CanCan::Ability
	
  def initialize(user)
  	funcoes = Cfue.where(["pessoa_fisica_cpf = ? and ativo = ? and unidade_exercicio_descricao = ?", user.pessoa_fisica_cpf, true, "NUAPP"]).pluck(:funcao_descricao)
		#OPERADOR
		if funcoes.include? 'Operador SIC'
			can :manage, :all
			cannot :destroy, Assistido
			cannot :destroy, Documento
			cannot :destroy_penal, ProcessoJudicial
			cannot :manage, PermissaoAcesso
		end

		#DEFENSOR
		if funcoes.include? 'Defensor PÃºblico'
			can :manage, :all
			cannot :destroy_penal, ProcessoJudicial
		end

		#NUDEP/2GRAUzz
		if funcoes.include? 'NUDEP' or funcoes.include? '2 GRAU'
			can :manage, :all			
			can :destroy_penal, ProcessoJudicial
			cannot :manage, PermissaoAcesso
		end		

		#DEBUG
		if user.pessoa_fisica_cpf == "02210439345"
			can :manage, :all
		end
  end
end
