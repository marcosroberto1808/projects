class ApplicationController < ActionController::Base
	#validações customizadas compartilhadas
	require "validacao"

	include ApplicationHelper

	#Aplica restrições de acesso do cancancan
  protect_from_forgery with: :exception
  before_filter :configure_permitted_parameters, if: :devise_controller?
  before_filter :authenticate_colaborador!

	#cancan user
	def current_user
		current_colaborador
	end

	#cancancan configs
	check_authorization :unless => :devise_controller?
	load_and_authorize_resource unless: :devise_controller?
  rescue_from CanCan::AccessDenied do |exception|
    redirect_to :back, :alert => "Você não tem autorização para executar esta ação."
  end

	#workaround para o problema com strong parameter do cancan
	#before_filter do
	#	resource = controller_name.singularize.to_sym
	#	method = "#{resource}_params"
	#	params[resource] &&= send(method) if respond_to?(method, true)
	#end

  def enhancement_ilike(field, term)
    "TRANSLATE(#{field}, 'áéíóúàèìòùãõâêîôôäëïöüçÁÉÍÓÚÀÈÌÒÙÃÕÂÊÎÔÛÄËÏÖÜÇ', 'aeiouaeiouaoaeiooaeioucAEIOUAEIOUAOAEIOOAEIOUC') ilike TRANSLATE('%#{term}%', 'áéíóúàèìòùãõâêîôôäëïöüçÁÉÍÓÚÀÈÌÒÙÃÕÂÊÎÔÛÄËÏÖÜÇ', 'aeiouaeiouaoaeiooaeioucAEIOUAEIOUAOAEIOOAEIOUC')"
  end

  protected

  def configure_permitted_parameters
    devise_parameter_sanitizer.for(:sign_in) { |u| u.permit(:pessoa_fisica_cpf, :ativo) }
  end
end
