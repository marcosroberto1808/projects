<%= stylesheet_link_tag "processos_judiciais" %>
<%= javascript_include_tag "jquery.mask", "mascaras", "datepicker", "processos_judiciais" %>

<% if @processo_judicial.local_atuacao_processo.length > 0 %>
  <h5>Locais atuação processo:</h5>
  <div id="locais_atuacao_processo">
    <% locais = get_locais_acessiveis %>
    
    <% locais[:locais_acessiveis].each do |local| %>
      <%= link_to local, method: :delete, data: { confirm: 'Tem certeza que deseja excluir este local?' } do %>      
        <span class="label label-danger" title="<%= local.lotacao_defensor.descricao_local %>">
          <%= local.lotacao_defensor.descricao_local %>
        </span>
      <% end %>  
    <% end %>

    <% locais[:locais_inacessiveis].each do |local| %>    
      <span class="label label-danger" title="<%= local.lotacao_defensor.descricao_local %>">
        <%= local.lotacao_defensor.descricao_local %>
      </span>
    <% end %>

  </div>  
<% end %>

<%= render "add_local" %>

<%= form_for(@processo_judicial) do |f| %>
  <div id="locais"></div>
  <% if @processo_judicial.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@processo_judicial.errors.count, "error") %> impediram este Processo Judicial de ser salvo:</h2>

      <ul>
      <% @processo_judicial.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <Label>Assistido: </label> <br>
    <%= @assistido.nome %>
  </div>

  <% if @inqueritos != nil %>
    <div class="field">
      <Label>Inquérito: </label> <br>
      <%= f.select :inquerito_policial_id, options_for_select(@inqueritos.map{|i| [i.numero, i.id]}, selected: @processo_judicial["inquerito_policial_id"]), :include_blank => true %>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :numero %><br>
    <%= f.text_field :numero, size: 20, class: "numero_processo" %>
  </div>

  <% if @processo_judicial.id == nil %> 
    <div class="field">
      <label>Juízo / Foro</label><br>
      <%= f.select :vara_id, options_for_select(@varas.map{|f|[f.nome+" / "+f.forum.nome, f.id]})  %>
    </div>
  <% end %>

  <% if @processo_judicial.id != nil %>
    <div class="field">
      <label>Atual Juízo / Foro</label><br>
      <%= @processo_judicial.vara.nome %>  - <%= @processo_judicial.vara.forum.nome %>
    </div>

    <div class="field">
      <label> Histórico de Locais</label><br>
      <% @processo_judicial.localizacao_processos.each do |historico| %>
        <%= historico.juizo %> - <%= historico.foro %>
        <%= l historico.updated_at %> <br>
      <% end %>
    </div>

    <label>Transferir Juízo/Foro </label>
    <div class="field">
      <%= f.select :vara_id, @varas.map{|f|[f.nome+" / "+f.forum.nome, f.id]} %>
    </div>

    <div class="field" id="div_vara">
    </div>
  <% end %>

  <% if @processo_judicial.id != nil %> 
    <Label>Natureza: </label> <br>
    <%= @processo_judicial.natureza %>
  <% end %>    

  <% if @processo_judicial.id == nil %>
    <div class="field" onclick="checkNatureza();">
      <%= f.label :natureza %><br>
      <% if @processo_judicial.natureza == "Ação Penal" %>
        <%= f.radio_button :natureza, "Ação Penal" %> Ação Penal <br>
        <%= f.radio_button :natureza, "Execução Penal" %> Execução Penal
      <% else %>
        <%= f.radio_button :natureza, "Ação Penal" %> Ação Penal <br>
        <%= f.radio_button :natureza, "Execução Penal" %> Execução Penal
      <% end %>     
    </div>
  <% end %>

  <% if @processo_judicial.id == nil %> <!-- CASO SEJA NEW -->
    <div class="field ocultar" id="div_tipo">
      <%= f.label :tipo %><br>
      <%= f.radio_button :tipo, "Provisório" %> Provisório
      <%= f.radio_button :tipo, "Definitivo" %> Definitivo  
    </div>

    <div class="field ocultar" id="div_tipo2">
      <%= f.label :status %><br>
      <%= f.radio_button :status, true %> Em Curso
      <%= f.radio_button :status, false %> Extinta  
    </div>

    <div id="acao_penal" class="ocultar">
      <div class="field">
        <%= f.label :julgado %><br>
        <%= f.radio_button :julgado, true %> Sim
        <%= f.radio_button :julgado, false %> Não
      </div>

      <div class="field">
        <%= f.label :recurso %><br>
        <%= f.radio_button :recurso, true  %> Sim
        <%= f.radio_button :recurso, false %> Não  
      </div>

      <div class="field">
        <%= f.label :carta_guia %><br>
        <%= f.radio_button :carta_guia, true %> Sim
        <%= f.radio_button :carta_guia, false %> Não  
      </div>
    </div>
  <% else %> <!-- CASO SEJA EDIT -->
    <% if @processo_judicial["natureza"] == "Execução Penal" %>
      <div id="execucao_penal">
        <%= f.label :tipo %><br>
        <% if @processo_judicial.tipo == "Provisório" %>
          <%= f.radio_button :tipo, "Provisório", checked: true %> Provisório
          <%= f.radio_button :tipo, "Definitivo" %> Definitivo  
        <% else %>
          <%= f.radio_button :tipo, "Provisório" %> Provisório
          <%= f.radio_button :tipo, "Definitivo", checked: true %> Definitivo  
        <% end %> 
      </div>

      <div class="field">
        <%= f.label :status %><br>
        <% if @processo_judicial.status == true %>
          <%= f.radio_button :status, true, checked: true %> Em Curso
          <%= f.radio_button :status, false %> Extinta        
        <% else %>
          <%= f.radio_button :status, true %> Em Curso
          <%= f.radio_button :status, false, checked: true %> Extinta
        <% end %>   
      </div>      
    <% else %>
      <div id="acao_penal">
        <div class="field">
          <%= f.label :julgado %><br>
          <% if @processo_judicial.julgado == true %>
            <%= f.radio_button :julgado, true, checked: true %> Sim
            <%= f.radio_button :julgado, false %> Não        
          <% else %>
            <%= f.radio_button :julgado, true %> Sim
            <%= f.radio_button :julgado, false, checked: true %> Não        
          <% end %>         
        </div>

        <div class="field">
          <%= f.label :recurso %><br>
          <% if @processo_judicial.recurso == true %>
            <%= f.radio_button :recurso, true, checked: true %> Sim
            <%= f.radio_button :recurso, false %> Não        
          <% else %>
            <%= f.radio_button :recurso, true %> Sim
            <%= f.radio_button :recurso, false, checked: true %> Não        
          <% end %>  
        </div>

        <div class="field">
          <%= f.label :carta_guia %><br>
          <% if @processo_judicial.carta_guia == true %>
            <%= f.radio_button :carta_guia, true, checked: true %> Sim
            <%= f.radio_button :carta_guia, false %> Não        
          <% else %>
            <%= f.radio_button :carta_guia, true %> Sim
            <%= f.radio_button :carta_guia, false, checked: true %> Não        
          <% end %>    
        </div>
      </div>
    <% end %>
  <% end %>

  <div class="field">
    <label>Data de Abertura</label><br>
    <% if @processo_judicial["data_abertura"] %>
      <%= f.text_field :data_abertura, value: (l @processo_judicial["data_abertura"]), size: 7, class: "campo_data" %>    
    <% else %>
      <%= f.text_field :data_abertura, size: 7, class: "campo_data" %>
    <% end %>  
  </div>

  <div class="field">
    <label>Data de Arquivamento</label><br>
    <% if @processo_judicial["data_arquivamente"] %>
      <%= f.text_field :data_arquivamente, value: (l @processo_judicial["data_arquivamente"]), size: 7, class: "campo_data" %>    
    <% else %>
      <%= f.text_field :data_arquivamente, size: 7, class: "campo_data" %>
    <% end %>  
  </div>  

  <div class="field">
    <%= f.label :resumo %><br>
    <%= f.text_area :resumo, cols: 50, rows: 5 %>
  </div>  

  <div class="actions">
    <div class="botao_left">
      <%= f.submit "Salvar", class: "btn btn-success" %> 
    </div>
<% end %>
    <div class="botao_left_margem">    
      <%= link_to 'Cancelar', "/assistidos/#{session["assistido_selecionado"]}", class: "btn btn-default" %>
    </div>
  <% if @processo_judicial.id != nil %>
    <% if @processo_judicial.natureza == "Ação Penal" %>
      <div class="botao_left_margem">    

        <%= link_to 'Excluir Processo', {:action => :destroy_penal, :controller => 'processo_judiciais', :id => @processo_judicial.id}, data: { confirm: 'Tem certeza que deseja excluir este processo?' }, type: 'button', class: "btn btn-danger", id: "excluir" %>
      </div>
    <% else %>
      <div class="botao_left_margem">    
        <%= link_to 'Excluir Processo', @processo_judicial, method: :delete, data: { confirm: 'Tem certeza que deseja excluir este processo?' }, type: 'button', class: "btn btn-danger", id: "excluir" %>
      </div>    
    <% end %>
  <% end %>  
  </div>
<br>
<hr>